unit orm.conexao.model_firedac.ModelFiredacConexao;

interface

uses IniFiles, orm.interfaces.Interfaces;

  type
    TModelFiredacConexao = class(TInterfacedObject, IModelConexao)
      private
        FConexao: TFDConnection;
        FArqIni: TIniFile;
      public
        constructor Create(pCaminho: string);
        destructor Destroy;override;
        class function New(pCaminhoIni: string): IModelConexao;
        function Connection: TObject;
    end;

implementation

{ TModelFiredacConexao }

function TModelFiredacConexao.Connection: TObject;
begin
   Result := FConexao;
end;

constructor TModelFiredacConexao.Create(pCaminho: string);
begin
   FArqIni := TIniFile.Create(pCaminho);
   FConexao := TFDConnection.Create(nil);
   FConexao.Params.DriverID := FArqIni.ReadString('Configuracao', 'Driver', 'Erro ao ler o valor.');
   FConexao.Params.HostName := FArqIni.ReadString('Configuracao', 'Host', 'Erro ao ler o valor.');
   FConexao.Params.Database := FArqIni.ReadString('Configuracao', 'Banco', 'Erro ao ler o valor.');
   FConexao.Params.UserName := FArqIni.ReadString('Configuracao', 'Usuario', 'Erro ao ler o valor.');
   FConexao.Params.Password := FArqIni.ReadString('Configuracao', 'Senha', 'Erro ao ler o valor.');
   FConexao.LoginPrompt := False;
   FConexao.Connected := true;
end;

destructor TModelFiredacConexao.Destroy;
begin
  FreeAndNil(FConexao);
  FreeAndNil(FArqIni);
  inherited;
end;

class function TModelFiredacConexao.New(pCaminhoIni: string): IModelConexao;
begin
  Result := Self.Create(pCaminhoIni);
end;

end.
